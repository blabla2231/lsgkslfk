<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>AI –ß–∞—Ç –∏ –ö–∞—Ç–∞–ª–æ–≥ (Demo V5 ‚Äî Pro Edition)</title>
    <style>
        /* ================================================================== */
        /* 1. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–¢–ò–õ–ò                                           */
        /* ================================================================== */
        :root {
            --bg-primary: #D1D9E6;
            --text-color: #444f6a;
            --accent-color: #007aff;
            --element-bg: #EAEAEA;

            /* –¢–µ–Ω–∏ –¥–ª—è –í–´–ü–£–ö–õ–´–• —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            --bubble-outer-shadow: rgba(0, 0, 0, 0.35);
            --bubble-bottom-inset: rgba(0, 0, 0, 0.25);
            --bubble-top-reflection: rgba(255, 255, 255, 0.9);
            --bubble-center-highlight: rgba(255, 255, 255, 0.7);

            /* –¢–µ–Ω–∏ –¥–ª—è –í–û–ì–ù–£–¢–´–• —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            --indent-shadow-top: rgba(0, 0, 0, 0.25);
            --indent-highlight-bottom: rgba(255, 255, 255, 1.0);

            --border-subtle: rgba(255, 255, 255, 0.5);
            
            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥–ª—è–Ω—Ü–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ (Glassmorphism) */
            --glass-glossy-bg: rgba(255, 255, 255, 0.5);
            --glass-glossy-border: rgba(255, 255, 255, 0.7);
            --glass-glossy-shadow: rgba(0, 0, 0, 0.2);
            --glass-glossy-highlight-inset: rgba(255, 255, 255, 0.8);

            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ */
            --current-bottom-bar-height: 100px;

            /* –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
            --bottom-bar-height: 80px;        /* –≤—ã—Å–æ—Ç–∞ —Ç–∞–±-–±–∞—Ä–∞ */
            --bottom-bar-offset: 45px;        /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            --bottom-bar-gap: 15px;           /* –∑–∞–∑–æ—Ä –Ω–∞–¥ –±–∞—Ä–æ–º */

 
        }

        [data-theme="dark"] {
            --bg-primary: #25282E;
            --text-color: #b0b8c4;
            --accent-color: #0084ff;
            --element-bg: #30343E;

            --bubble-outer-shadow: rgba(0, 0, 0, 0.7);
            --bubble-bottom-inset: rgba(0, 0, 0, 0.5);
            --bubble-top-reflection: rgba(255, 255, 255, 0.15);
            --bubble-center-highlight: rgba(255, 255, 255, 0.1);
            
            --indent-shadow-top: rgba(0, 0, 0, 0.4);
            --indent-highlight-bottom: rgba(255, 255, 255, 0.1);

            --border-subtle: rgba(255, 255, 255, 0.06);

            --glass-glossy-bg: rgba(48, 52, 62, 0.5);
            --glass-glossy-border: rgba(255, 255, 255, 0.1);
            --glass-glossy-shadow: rgba(0, 0, 0, 0.5);
            --glass-glossy-highlight-inset: rgba(255, 255, 255, 0.15);
        }

        /* ================================================================== */
        /* 2. –û–ë–©–ò–ï –°–¢–ò–õ–ò –°–¢–†–£–ö–¢–£–†–´                                         */
        /* ================================================================== */
        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-color);
            transition: background 0.3s ease, color 0.3s ease;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        .body-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .content {
            padding: 15px 15px calc(var(--bottom-bar-height) + var(--bottom-bar-offset) + var(--bottom-bar-gap)) 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex-grow: 1;
            overflow-x: hidden;
            transition: padding-bottom 0.25s ease-out;
            padding-top: 72px;
        }

        .content::-webkit-scrollbar { width: 0; }
        .content { -ms-overflow-style: none; scrollbar-width: none; }

        @media (min-width: 768px) {
            .body-wrapper {
                max-width: 420px; 
                border-radius: 20px;
                margin-top: 20px;
                height: calc(100vh - 40px);
                box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            }
        }

        /* ================================================================== */
        /* 3. –®–ê–ü–ö–ê                                                         */
        /* ================================================================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: var(--bg-primary);
            z-index: 200;
            max-width: 420px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .header {
                border-radius: 20px 20px 0 0;
                margin-top: 20px;
            }
        }

        .header #floating-back-btn {
            position: static;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            cursor: pointer;
        }
        
        .header #floating-back-btn.visible {
            visibility: visible;
        }

        .header #screen-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }

        /* ================================================================== */
        /* 4. –ù–ê–í–ò–ì–ê–¶–ò–Ø: TAB BAR –ò CHAT INPUT BAR                           */
        /* ================================================================== */
        .tab-bar {
            position: absolute;
            left: 15px;
            right: 15px;
            z-index: 100;
            bottom: var(--bottom-bar-offset);
            max-width: 390px;
            height: var(--bottom-bar-height); 
            background: var(--glass-glossy-bg); 
            backdrop-filter: blur(15px); 
            -webkit-backdrop-filter: blur(15px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            border-radius: 25px;
            border: 1px solid var(--glass-glossy-border);
            box-shadow: 0 10px 30px -10px var(--glass-glossy-shadow), inset 0 1px 1px var(--glass-glossy-highlight-inset);
            transition: opacity 0.3s ease, visibility 0.3s ease;
            margin: 0 auto;
        }

        .tab-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-color);
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            transition: color 0.3s ease;
        }

        .tab-button .icon-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            width: 45px;
            height: 45px;
            background: var(--element-bg);
            border: 1px solid var(--border-subtle);
            box-shadow: 0 8px 12px -4px var(--bubble-outer-shadow), 0 -6px 10px -4px var(--bubble-top-reflection), inset 0 -3px 6px -3px var(--bubble-bottom-inset), inset 0 3px 6px -3px var(--bubble-center-highlight);
            transition: all 300ms cubic-bezier(0.23, 1, 0.32, 1);
        }

        .tab-button:active .icon-wrapper {
            transform: scale(0.97);
            box-shadow: inset 0 6px 10px 0 var(--indent-shadow-top), inset 0 -4px 8px 0 var(--indent-highlight-bottom);
        }

        .tab-button.active { color: var(--accent-color); }
        .tab-button.active .icon-wrapper {
            box-shadow: inset 0 6px 10px 0 var(--indent-shadow-top), inset 0 -4px 8px 0 var(--indent-highlight-bottom);
        }

        .tab-button svg { width: 22px; height: 22px; fill: var(--text-color); transition: fill 0.3s ease; }
        .tab-button.active svg { fill: var(--accent-color); }

        .chat-input-bar {
            position: absolute;
            left: 0;
            right: 0;
            z-index: 100;
            bottom: var(--bottom-bar-offset);
            padding: 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .chat-input-bar.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* ================================================================== */
        /* 5. –ö–ò–†–ü–ò–ß–ò (–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã UI)                       */
        /* ================================================================== */
        .btn-outset, .search-input, .chat-action-btn {
            background: var(--element-bg);
            border: 1px solid var(--border-subtle);
            box-shadow: 0 8px 12px -4px var(--bubble-outer-shadow), 0 -6px 10px -4px var(--bubble-top-reflection), inset 0 -3px 6px -3px var(--bubble-bottom-inset), inset 0 3px 6px -3px var(--bubble-center-highlight);
            transition: all 300ms cubic-bezier(0.23, 1, 0.32, 1);
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
            border-radius: 15px;
            color: var(--text-color);
            font-family: inherit;
            font-size: 14px;
            padding: 12px 15px;
        }

        .btn-outset:active {
            transform: scale(0.97);
            box-shadow: inset 0 6px 10px 0 var(--indent-shadow-top), inset 0 -4px 8px 0 var(--indent-highlight-bottom);
        }

        .card-inset {
            background: var(--bg-primary);
            border-radius: 20px;
            border: 1px solid var(--border-subtle);
            box-shadow: inset 0 6px 10px 0 var(--indent-shadow-top), inset 0 -4px 8px 0 var(--indent-highlight-bottom);
            padding: 15px;
        }

        /* ================================================================== */
        /* 6. –ö–ê–¢–ê–õ–û–ì                                                       */
        /* ================================================================== */
        .catalog-search-bar { 
            width: 100%;
            height: 45px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            margin-bottom: 15px;
        }

        .catalog-search-bar input {
            flex-grow: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-color);
            font-size: 16px;
            margin-left: 10px;
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            transition: all 0.3s ease;
        }

        .catalog-grid.view-list {
            grid-template-columns: 1fr;
        }

        .product-card {
            background: transparent;
            border: none;
            box-shadow: none;
            border-radius: 15px;
            padding: 0;
            text-align: center;
            cursor: pointer;
            isolation: isolate;
        }

        .product-card .img-container {
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 10px;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            box-shadow: inset 0 6px 10px 0 var(--indent-shadow-top), inset 0 -4px 8px 0 var(--indent-highlight-bottom);
            position: relative;
        }

        .product-card img { 
            width: 100%; 
            height: 100px; 
            object-fit: cover; 
            border-radius: 10px;
        }

        .product-rating { 
            position: absolute;
            top: 18px;
            right: 18px; 
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #27ae60;
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .product-card .btn-outset { 
            width: 100%;
            padding: 8px 5px;
            border-radius: 10px; 
            font-weight: 600;
            font-size: 13px;
            margin-top: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-price { 
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .filter-buttons { 
            display: flex;
            gap: 10px;
            margin-bottom: 15px; 
            overflow-x: auto;
            padding-bottom: 5px; 
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .filter-buttons::-webkit-scrollbar { display: none; }

        .filter-buttons .btn-outset { 
            padding: 10px 18px;
            border-radius: 25px; 
            font-size: 14px;
            white-space: nowrap; 
            font-weight: bold;
        }

        /* ================================================================== */
        /* 7. –ß–ê–¢                                                           */
        /* ================================================================== */
        .chat-container { 
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-message { 
            display: flex;
        }

        .chat-bubble { 
            max-width: 80%;
            border-radius: 18px;
            line-height: 1.4;
            padding: 12px 15px;
            word-wrap: break-word;
        }
        
        .ai-message { 
            justify-content: flex-start;
        }

        .ai-message .chat-bubble { 
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            box-shadow: inset 0 6px 10px 0 var(--indent-shadow-top), inset 0 -4px 8px 0 var(--indent-highlight-bottom);
            border-bottom-left-radius: 2px;
        }
        
        .user-message { 
            justify-content: flex-end;
        }

        .user-message .chat-bubble { 
            background: var(--element-bg);
            border: 1px solid var(--border-subtle);
            box-shadow: 0 8px 12px -4px var(--bubble-outer-shadow), 0 -6px 10px -4px var(--bubble-top-reflection), inset 0 -3px 6px -3px var(--bubble-bottom-inset), inset 0 3px 6px -3px var(--bubble-center-highlight);
            border-bottom-right-radius: 2px;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 15px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-color);
            opacity: 0.5;
            animation: typing-bounce 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing-bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        .chat-action-btn { 
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 8px -2px var(--bubble-outer-shadow);
            cursor: pointer;
        }

        .chat-action-btn.added {
            background: #27ae60;
            color: white;
            pointer-events: none;
        }

        .chat-input-field { 
            flex-grow: 1;
            height: 50px;
            border-radius: 25px;
            padding: 0 20px;
        }

        .chat-input-field input { 
            width: 100%;
            height: 100%;
            background: none;
            border: none;
            outline: none;
            color: var(--text-color);
            font-size: 16px;
        }

        .chat-action-btn-small { 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .chat-action-btn-small svg { 
            fill: var(--text-color);
            width: 24px;
            height: 24px;
        }

        /* ================================================================== */
        /* 8. –°–ü–ò–°–û–ö –ü–û–ö–£–ü–û–ö                                                */
        /* ================================================================== */
        .list-group { 
            margin-bottom: 25px;
        }

        .list-group-header { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 10px;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .list-group-header:hover {
            opacity: 0.7;
        }

        .list-item { 
            display: flex;
            justify-content: space-between;
            align-items: center; 
            border-radius: 15px;
            padding: 12px 15px;
            margin-top: 5px;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }

        .item-name { 
            flex-grow: 1;
            font-size: 16px;
            font-weight: 500;
        }

        .list-item.done .item-name { 
            text-decoration: line-through;
            opacity: 0.6;
        }

        .checkbox-switch {
            position: relative;
            width: 50px;
            height: 26px;
            border-radius: 13px;
            padding: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-slider {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--bg-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .list-item.done .checkbox-slider {
            transform: translateX(24px);
            background: #27ae60;
        }

        /* ================================================================== */
        /* 9. –ü–†–û–§–ò–õ–¨                                                       */
        /* ================================================================== */
        .profile-section { 
            margin-bottom: 30px;
        }

        .profile-section h3 { 
            font-size: 18px;
            font-weight: 600;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .profile-card { 
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }

        .profile-card h4 { 
            margin: 10px 0 0;
        }

        .profile-card p { 
            font-size: 14px;
            opacity: 0.7;
        }

        .setting-button { 
            width: 100%;
            padding: 15px;
            border-radius: 15px; 
            text-align: left;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            background: var(--element-bg);
            border: 1px solid var(--border-subtle);
            box-shadow: 0 8px 12px -4px var(--bubble-outer-shadow), 0 -6px 10px -4px var(--bubble-top-reflection), inset 0 -3px 6px -3px var(--bubble-bottom-inset), inset 0 3px 6px -3px var(--bubble-center-highlight);
            transition: all 300ms cubic-bezier(0.23, 1, 0.32, 1);
            color: var(--text-color);
            font-family: inherit;
            border: none;
        }

        .setting-button span { 
            opacity: 0.7;
            font-size: 14px;
        }

        /* ================================================================== */
        /* 10. –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û                                               */
        /* ================================================================== */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            z-index: 998;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        #modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-content h3 { 
            margin-top: 0;
        }

        .modal-content .btn-outset { 
            width: 100%;
            margin-top: 10px;
            padding: 12px;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .modal-content .btn-outset.selected {
            background: var(--accent-color);
            color: white;
        }



        /* ================================================================== */
        /* 12. –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –°–ö–ï–õ–ï–¢–´                                        */
        /* ================================================================== */
        .toast {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            left: 50%;
            bottom: 120px;
            transform: translate(-50%, 0);
            min-width: 200px;
            background: var(--element-bg);
            color: var(--text-color);
            text-align: center;
            border-radius: 20px;
            padding: 15px 20px;
            z-index: 999;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            font-size: 14px;
            font-weight: 600;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s ease-out;
        }

        .toast.show { 
            visibility: visible;
            opacity: 1;
            transform: translate(-50%, -20px);
        }

        .screen { 
            display: none;
            width: 100%;
        }

        .screen.active { 
            display: block;
        }

        .skeleton {
            background: linear-gradient(90deg, var(--element-bg) 25%, var(--bg-primary) 50%, var(--element-bg) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 10px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

    </style>
</head>
<body>

    <div class="body-wrapper">
        <!-- HEADER -->
        <div class="header">
            <button id="floating-back-btn" class="btn-outset">
                <svg viewBox="0 0 24 24" width="24" height="24"><path fill="var(--text-color)" d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>
            </button>
            <h2 id="screen-title"></h2>
            <div style="width: 45px;"></div>
        </div>

        <!-- CONTENT AREA -->
        <div class="content">

            <!-- SCREEN 1: CATALOG -->
            <div id="catalog-screen" class="screen active">
                <div class="card-inset catalog-search-bar" style="margin-bottom: 15px;">
                    <svg style="fill:var(--text-color); opacity:0.6;" viewBox="0 0 24 24" width="20" height="20">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                    <input type="text" id="catalog-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É...">
                </div>
                
                <div class="filter-buttons" style="margin-bottom: 10px;">
                    <button class="btn-outset" onclick="ScreenNavigation.navigateTo('all-products-screen')">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
                    <button class="btn-outset" onclick="ScreenNavigation.navigateTo('categories-screen')">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                    <button class="btn-outset" id="view-toggle" style="padding: 10px; border-radius: 50%; width: 45px; height: 45px;">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="var(--text-color)" d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"/></svg>
                    </button>
                </div>

                <div class="filter-buttons">
                    <button class="btn-outset" id="sort-btn" onclick="ModalOrchestrator.show('sort')">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn-outset" id="filter-btn" onclick="ModalOrchestrator.show('filter')">–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</button>
                </div>

                <div class="catalog-grid" id="catalog-grid">
                    <div class="product-card" onclick="ProductDetailsScreen.show(this)">
                        <div class="img-container">
                            <img src="https://placehold.co/150x100/27ae60/FFF?text=–ô–æ–≥—É—Ä—Ç" alt="–ô–æ–≥—É—Ä—Ç –ß—É–¥–æ" />
                            <div class="product-rating" style="background-color:#27ae60;">8.7</div>
                        </div>
                        <button class="btn-outset">–ô–æ–≥—É—Ä—Ç –ß—É–¥–æ –í–∏—à–Ω—è</button>
                        <p class="product-price">89.90 —Ä—É–±.</p>
                    </div>
                    <div class="product-card" onclick="ProductDetailsScreen.show(this)">
                        <div class="img-container">
                            <img src="https://placehold.co/150x100/f39c12/FFF?text=–•–ª–µ–±—Ü—ã" alt="–•–ª–µ–±—Ü—ã" />
                            <div class="product-rating" style="background-color:#f39c12;">4.2</div>
                        </div>
                        <button class="btn-outset">–•–ª–µ–±—Ü—ã Fit Start</button>
                        <p class="product-price">125.00 —Ä—É–±.</p>
                    </div>
                    <div class="product-card" onclick="ProductDetailsScreen.show(this)">
                        <div class="img-container">
                            <img src="https://placehold.co/150x100/c0392b/FFF?text=–ü—Ä–æ–¥—É–∫—Ç" alt="–ü—Ä–æ–¥—É–∫—Ç" />
                            <div class="product-rating" style="background-color:#c0392b;">2.1</div>
                        </div>
                        <button class="btn-outset">–ö—Ä—É–∞—Å—Å–∞–Ω –û–±—ã—á–Ω—ã–π</button>
                        <p class="product-price">45.50 —Ä—É–±.</p>
                    </div>
                    <div class="product-card" onclick="ProductDetailsScreen.show(this)"><div class="img-container"><img src="https://placehold.co/150x100/555/FFF?text=–ú—è—Å–æ" alt="–ú—è—Å–æ" /><div class="product-rating" style="background-color:#27ae60;">9.1</div></div><button class="btn-outset">–§–∞—Ä—à –ì–æ–≤—è–∂–∏–π</button><p class="product-price">350.00 —Ä—É–±.</p></div>
                    <div class="product-card" onclick="ProductDetailsScreen.show(this)"><div class="img-container"><img src="https://placehold.co/150x100/555/FFF?text=–ß–∞–π" alt="–ß–∞–π" /><div class="product-rating" style="background-color:#27ae60;">7.8</div></div><button class="btn-outset">–ß–∞–π –ó–µ–ª–µ–Ω—ã–π</button><p class="product-price">220.00 —Ä—É–±.</p></div>
                    <div class="product-card" onclick="ProductDetailsScreen.show(this)"><div class="img-container"><img src="https://placehold.co/150x100/555/FFF?text=–ù–∞–ø–∏—Ç–æ–∫" alt="–ù–∞–ø–∏—Ç–æ–∫" /><div class="product-rating" style="background-color:#f39c12;">5.5</div></div><button class="btn-outset">–ì–∞–∑–∏—Ä–æ–≤–∫–∞ '–°–ª–∞–¥–æ—Å—Ç—å'</button><p class="product-price">70.00 —Ä—É–±.</p></div>
                </div>
            </div>

            <!-- SCREEN 2: CHAT -->
            <div id="chat-screen" class="screen"> 
                 <div class="chat-container" id="chat-messages">
                    <div class="chat-message ai-message">
                        <div class="chat-bubble card-inset">
                            –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—ã–º –ø–æ–∫—É–ø–∫–∞–º. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCREEN 3: SHOPPING LIST -->
            <div id="list-screen" class="screen">
                <div class="list-group">
                    <div class="list-group-header">
                        <span>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ (–°–µ–≥–æ–¥–Ω—è)</span>
                    </div>
                    <div class="list-container">
                        <div class="list-item card-inset" onclick="ShoppingListModule.toggleItem(this)">
                            <span class="item-name">–ô–æ–≥—É—Ä—Ç Activia Natural</span>
                            <div class="checkbox-switch btn-outset"><div class="checkbox-slider"></div></div>
                        </div>
                        <div class="list-item card-inset done" onclick="ShoppingListModule.toggleItem(this)">
                            <span class="item-name">–•–ª–µ–±—Ü—ã Fit Start (–ö—É–ø–ª–µ–Ω–æ)</span>
                            <div class="checkbox-switch btn-outset"><div class="checkbox-slider"></div></div>
                        </div>
                         <div class="list-item card-inset" onclick="ShoppingListModule.toggleItem(this)">
                            <span class="item-name">–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ</span>
                            <div class="checkbox-switch btn-outset"><div class="checkbox-slider"></div></div>
                        </div>
                    </div>
                </div>

                <div class="list-group">
                    <div class="list-group-header" onclick="ShoppingListModule.toggleHistory(this)">
                        <span>–ò—Å—Ç–æ—Ä–∏—è –ü–æ–∫—É–ø–æ–∫</span>
                        <svg class="history-arrow" viewBox="0 0 24 24" width="20" height="20" style="fill:var(--text-color); transition: transform 0.3s ease;"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>
                    </div>
                    <div class="list-container history-items" style="display:none; opacity: 0.5;">
                        <p style="font-size: 14px; font-weight: bold; margin-bottom: 5px;">8 –ù–æ—è–±—Ä—è 2025</p>
                        <div class="list-item card-inset done">
                            <span class="item-name">–ú–æ–ª–æ–∫–æ</span>
                            <div class="checkbox-switch btn-outset"><div class="checkbox-slider"></div></div>
                        </div>
                        <p style="font-size: 14px; font-weight: bold; margin-top: 15px; margin-bottom: 5px;">7 –ù–æ—è–±—Ä—è 2025</p>
                        <div class="list-item card-inset done">
                            <span class="item-name">–°—ã—Ä</span>
                            <div class="checkbox-switch btn-outset"><div class="checkbox-slider"></div></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCREEN 4: PRODUCT DETAILS -->
            <div id="details-screen" class="screen">
            </div>

            <!-- SCREEN 5: PROFILE -->
            <div id="profile-screen" class="screen">
                <div class="profile-section">
                    <div class="card-inset profile-card">
                        <img src="https://placehold.co/80x80/007aff/FFFFFF?text=P" style="border-radius:50%; margin-bottom:10px;" alt="–ü—Ä–æ—Ñ–∏–ª—å" />
                        <h4 style="color:var(--accent-color);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h4>
                        <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</p>
                    </div>
                </div>

                <div class="profile-section">
                    <h3>–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏ –ó–¥–æ—Ä–æ–≤—å–µ</h3>
                    <button class="setting-button" onclick="ScreenNavigation.navigateTo('store-screen')">
                        –ú–∞–≥–∞–∑–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é <span>–ú–∞–≥–Ω–∏—Ç ></span>
                    </button>
                    <button class="setting-button" onclick="ScreenNavigation.navigateTo('allergy-screen')">
                        –ê–ª–ª–µ—Ä–≥–∏–∏ <span>–ú–æ–ª–æ–∫–æ, –ì–ª—é—Ç–µ–Ω ></span>
                    </button>
                </div>

                <div class="profile-section">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ UI</h3>
                    <button id="theme-toggle-profile" class="setting-button">
                        <span style="display: flex; align-items: center; gap: 8px;">
                            <svg id="theme-icon" width="20" height="20" viewBox="0 0 24 24"><path fill="var(--text-color)" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                            –°–≤–µ—Ç–ª–∞—è / –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
                        </span>
                        <span id="theme-label">–¢–µ–∫—É—â–∞—è: –°–≤–µ—Ç–ª–∞—è</span>
                    </button>
                </div>
            </div>

            <!-- SUB SCREENS -->
            <div id="all-products-screen" class="screen">
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö 5000+ —Ç–æ–≤–∞—Ä–æ–≤...</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="skeleton" style="height: 200px;"></div>
                </div>
            </div>

            <div id="categories-screen" class="screen">
                <h3>–≠–∫—Ä–∞–Ω –ö–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
                <button class="setting-button" onclick="CatalogModule.filterByCategory('dairy')">üßÄ –ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã <span>215 —Ç–æ–≤–∞—Ä–æ–≤</span></button>
                <button class="setting-button" onclick="CatalogModule.filterByCategory('meat')">ü•© –ú—è—Å–æ –∏ –ü—Ç–∏—Ü–∞ <span>184 —Ç–æ–≤–∞—Ä–∞</span></button>
                <button class="setting-button" onclick="CatalogModule.filterByCategory('grocery')">üåæ –ë–∞–∫–∞–ª–µ—è <span>502 —Ç–æ–≤–∞—Ä–∞</span></button>
            </div>

            <div id="store-screen" class="screen">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ú–∞–≥–∞–∑–∏–Ω–∞</h3>
                <button class="setting-button selected" onclick="ProfileModule.selectStore(this)">–ú–∞–≥–Ω–∏—Ç <span>‚úì –í—ã–±—Ä–∞–Ω–æ</span></button>
                <button class="setting-button" onclick="ProfileModule.selectStore(this)">–ü—è—Ç–µ—Ä–æ—á–∫–∞ <span>></span></button>
                <button class="setting-button" onclick="ProfileModule.selectStore(this)">–ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫ <span>></span></button>
            </div>

             <div id="allergy-screen" class="screen">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ê–ª–ª–µ—Ä–≥–∏–π</h3>
                <div class="list-item card-inset" onclick="ProfileModule.toggleAllergy(this)" style="margin-bottom: 10px;">
                    <span class="item-name">–ú–æ–ª–æ–∫–æ</span>
                    <div class="checkbox-switch btn-outset done"><div class="checkbox-slider"></div></div>
                </div>
                <div class="list-item card-inset" onclick="ProfileModule.toggleAllergy(this)" style="margin-bottom: 10px;">
                    <span class="item-name">–ì–ª—é—Ç–µ–Ω</span>
                    <div class="checkbox-switch btn-outset done"><div class="checkbox-slider"></div></div>
                </div>
                <div class="list-item card-inset" onclick="ProfileModule.toggleAllergy(this)">
                    <span class="item-name">–û—Ä–µ—Ö–∏</span>
                    <div class="checkbox-switch btn-outset"><div class="checkbox-slider"></div></div>
                </div>
            </div>

        </div>

        <!-- FIXED BOTTOM LAYERS -->
        <div id="chat-input-area" class="chat-input-bar">
            <button class="chat-action-btn-small btn-outset">
                <svg viewBox="0 0 24 24"><path fill="var(--text-color)" d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v11.5c0 2.76 2.24 5 5 5s5-2.24 5-5V6h-1.5z"/></svg>
            </button>
            <div class="chat-input-field card-inset">
                <input type="text" id="chat-input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ –ò–ò...">
            </div>
            <button class="chat-action-btn-small btn-outset" onclick="ChatModule.sendMessage()">
                <svg viewBox="0 0 24 24"><path fill="var(--text-color)" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>

        <div id="main-tab-bar" class="tab-bar">
            <button class="tab-button active" data-target="catalog-screen">
                <div class="icon-wrapper"><svg viewBox="0 0 24 24"><path fill="var(--text-color)" d="M12 10a5 5 0 0 1 5 5v7h-2v-7a3 3 0 0 0-3-3 3 3 0 0 0-3 3v7H7v-7a5 5 0 0 1 5-5zM12 1L8 5h8zM4 17h2v5H4zM18 17h2v5h-2z"/></svg></div>
                <span>–ö–∞—Ç–∞–ª–æ–≥</span>
            </button>
            <button class="tab-button" data-target="chat-screen">
                <div class="icon-wrapper"><svg viewBox="0 0 24 24"><path fill="var(--text-color)" d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg></div>
                <span>AI –ß–∞—Ç</span>
            </button>
            <button class="tab-button" data-target="list-screen">
                <div class="icon-wrapper"><svg viewBox="0 0 24 24"><path fill="var(--text-color)" d="M14 10H6v2h8v-2zm0-4H6v2h8V6zm1.5 10c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM21 6H11V4h10v2zm0 4H11V8h10v2zm0 4H11v-2h10v2zm-2 4h-8v-2h8v2z"/></svg></div>
                <span>–°–ø–∏—Å–æ–∫</span>
            </button>
            <button class="tab-button" data-target="profile-screen">
                <div class="icon-wrapper"><svg viewBox="0 0 24 24"><path fill="var(--text-color)" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
        </div>
    </div>
    
    <!-- MODAL OVERLAY -->
    <div id="modal-overlay" onclick="ModalOrchestrator.hide()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="modal-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
            <div id="modal-body"></div>
            <button class="btn-outset" style="margin-top: 20px; background: var(--accent-color); color: white;" onclick="ModalOrchestrator.apply()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
    </div>


    
    <div id="toast-notification" class="toast"></div>

    <script>
        /* ================================================================== */
        /* 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –ö–û–ù–°–¢–ê–ù–¢–´ (–°–ê–ú–´–ô –í–ï–†–•)                        */
        /* ================================================================== */

        const CONFIG = {
            SIZES: {
                HEADER_HEIGHT: 56,
                TAB_BAR_HEIGHT: 100,
                CHAT_INPUT_HEIGHT: 100,
                BORDER_RADIUS_DEFAULT: 20,
                BORDER_RADIUS_BUTTON: 15,
                PADDING_DEFAULT: 15,
            },
            ANIMATIONS: {
                TRANSITION_DURATION: 300,
                TYPING_DURATION: 1500,
                TOAST_DURATION: 2000,
            },
            SCREENS: {
                CATALOG: 'catalog-screen',
                CHAT: 'chat-screen',
                LIST: 'list-screen',
                PROFILE: 'profile-screen',
                DETAILS: 'details-screen',
            },
        };

        const TAB_SCREENS = [CONFIG.SCREENS.CATALOG, CONFIG.SCREENS.LIST, CONFIG.SCREENS.PROFILE];

        const TG_MOCK = {
            WebApp: {
                colorScheme: 'light',
                HapticFeedback: {
                    impactOccurred: (style) => console.log(`Haptic: ${style}`),
                },
            }
        };

        let AppState = {
            currentScreen: CONFIG.SCREENS.CATALOG,
            currentInputField: null,
            selectedFilters: [],
            selectedSort: null,
        };

        /* ================================================================== */
        /* 2. –ö–ò–†–ü–ò–ß–ò (SIMPLE FUNCTIONS - ONE ACTION EACH)                 */
        /* ================================================================== */

        const Brick = {
            addClass: (el, className) => el?.classList.add(className),
            removeClass: (el, className) => el?.classList.remove(className),
            toggleClass: (el, className) => el?.classList.toggle(className),
            show: (el) => el && (el.style.opacity = '1', el.style.visibility = 'visible'),
            hide: (el) => el && (el.style.opacity = '0', el.style.visibility = 'hidden'),
            haptic: (type = 'light') => TG_MOCK.WebApp.HapticFeedback.impactOccurred(type),
            showToast: (message) => {
                const toast = document.getElementById('toast-notification');
                if (!toast) return;
                toast.textContent = message;
                Brick.addClass(toast, 'show');
                setTimeout(() => Brick.removeClass(toast, 'show'), CONFIG.ANIMATIONS.TOAST_DURATION);
            },
        };

        const DOM = {
            getScreenById: (id) => document.getElementById(id),
            getAllScreens: () => document.querySelectorAll('.screen'),
            getTabButtons: () => document.querySelectorAll('.tab-button'),
            getBackButton: () => document.getElementById('floating-back-btn'),
            getTitle: () => document.getElementById('screen-title'),
            getContent: () => document.querySelector('.content'),
            getTabBar: () => document.getElementById('main-tab-bar'),
            getChatInputBar: () => document.getElementById('chat-input-area'),
            getChatInput: () => document.getElementById('chat-input'),
            getChatMessages: () => document.getElementById('chat-messages'),
            getRoot: () => document.documentElement,
        };

        /* ================================================================== */
        /* 3. –û–†–ö–ï–°–¢–†–ê–¢–û–†–´ (KOORDINATORY)                                  */
        /* ================================================================== */

        const ScreenNavigation = {
            navigateTo: (targetId) => {
                if (targetId === AppState.currentScreen) return;
                
                Brick.haptic('light');

                const isChatScreen = targetId === CONFIG.SCREENS.CHAT;
                const isTabScreen = TAB_SCREENS.includes(targetId);
                const isSubScreen = !isTabScreen && !isChatScreen;

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                ScreenNavigation.updateUIState(targetId, isTabScreen, isChatScreen);
                ScreenNavigation.switchScreen(targetId);
                DOM.getContent().scrollTop = 0;
            },

            updateUIState: (screenId, isTabScreen, isChatScreen) => {
                // Tab bar
                DOM.getTabBar().style.visibility = isTabScreen ? 'visible' : 'hidden';
                DOM.getTabBar().style.opacity = isTabScreen ? '1' : '0';

                // Chat input
                const chatBar = DOM.getChatInputBar();
                isChatScreen ? Brick.addClass(chatBar, 'active') : Brick.removeClass(chatBar, 'active');

                // üî• –î–û–ë–ê–í–õ–ï–ù–û: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã—Å–æ—Ç—ã –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏
                const barHeight = isChatScreen ? '50px' : '80px';
                const root = DOM.getRoot();
                root.style.setProperty('--bottom-bar-height', barHeight);

                // Back button –∏ title
                const backBtn = DOM.getBackButton();
                const showBack = !TAB_SCREENS.includes(screenId);
                showBack ? Brick.addClass(backBtn, 'visible') : Brick.removeClass(backBtn, 'visible');

                const titles = {
                    [CONFIG.SCREENS.CATALOG]: '–£–º–Ω—ã–π –ö–∞—Ç–∞–ª–æ–≥',
                    [CONFIG.SCREENS.CHAT]: 'AI –ß–∞—Ç',
                    [CONFIG.SCREENS.LIST]: '–°–ø–∏—Å–æ–∫ –ü–æ–∫—É–ø–æ–∫',
                    [CONFIG.SCREENS.PROFILE]: '–ü—Ä–æ—Ñ–∏–ª—å',
                };
                DOM.getTitle().textContent = titles[screenId] || '';


            },

            switchScreen: (targetId) => {
                DOM.getAllScreens().forEach(screen => Brick.removeClass(screen, 'active'));
                Brick.addClass(DOM.getScreenById(targetId), 'active');

                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ç–∞–±–∞
                DOM.getTabButtons().forEach(btn => Brick.removeClass(btn, 'active'));
                const activeBtn = document.querySelector(`.tab-button[data-target="${targetId}"]`);
                if (activeBtn) Brick.addClass(activeBtn, 'active');

                AppState.currentScreen = targetId;
            },
        };

        const ModalOrchestrator = {
            show: (type) => {
                Brick.haptic('medium');
                const modal = document.getElementById('modal-overlay');
                const title = document.getElementById('modal-title');
                const body = document.getElementById('modal-body');

                if (type === 'sort') {
                    title.textContent = '–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ:';
                    body.innerHTML = `
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="quality">–ü–æ –∫–∞—á–µ—Å—Ç–≤—É (AI –†–µ–π—Ç–∏–Ω–≥)</button>
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="price-asc">–ü–æ —Ü–µ–Ω–µ (—Å–Ω–∞—á–∞–ª–∞ –¥–µ—à–µ–≤—ã–µ)</button>
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="price-desc">–ü–æ —Ü–µ–Ω–µ (—Å–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ)</button>
                    `;
                    
                    body.querySelectorAll('.btn-outset').forEach(btn => {
                        btn.addEventListener('click', function() {
                            body.querySelectorAll('.btn-outset').forEach(b => Brick.removeClass(b, 'selected'));
                            Brick.addClass(this, 'selected');
                            AppState.selectedSort = this.dataset.value;
                        });
                    });
                    
                    if (AppState.selectedSort) {
                        const selectedBtn = body.querySelector(`[data-value="${AppState.selectedSort}"]`);
                        if (selectedBtn) Brick.addClass(selectedBtn, 'selected');
                    }
                } else if (type === 'filter') {
                    title.textContent = '–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:';
                    body.innerHTML = `
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="vegan">–í–µ–≥–∞–Ω</button>
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="no-sugar">–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞</button>
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="no-gluten">–ë–µ–∑ –≥–ª—é—Ç–µ–Ω–∞</button>
                        <button class="btn-outset" style="width: 100%; text-align: left; margin-bottom: 10px;" data-value="high-protein">–í—ã—Å–æ–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –±–µ–ª–∫–∞</button>
                    `;
                    
                    body.querySelectorAll('.btn-outset').forEach(btn => {
                        btn.addEventListener('click', function() {
                            Brick.toggleClass(this, 'selected');
                            const value = this.dataset.value;
                            AppState.selectedFilters.includes(value) 
                                ? AppState.selectedFilters = AppState.selectedFilters.filter(f => f !== value)
                                : AppState.selectedFilters.push(value);
                        });
                    });
                    
                    AppState.selectedFilters.forEach(filter => {
                        const btn = body.querySelector(`[data-value="${filter}"]`);
                        if (btn) Brick.addClass(btn, 'selected');
                    });
                }
                
                Brick.addClass(modal, 'active');
            },

            hide: () => {
                Brick.removeClass(document.getElementById('modal-overlay'), 'active');
            },

            apply: () => {
                ModalOrchestrator.hide();
                
                if (AppState.selectedSort) {
                    const sortBtn = document.getElementById('sort-btn');
                    const sortNames = {
                        'quality': '–ü–æ –∫–∞—á–µ—Å—Ç–≤—É ‚Üì',
                        'price-asc': '–ü–æ —Ü–µ–Ω–µ ‚Üë',
                        'price-desc': '–ü–æ —Ü–µ–Ω–µ ‚Üì'
                    };
                    sortBtn.textContent = '–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å: ' + sortNames[AppState.selectedSort];
                }
                
                if (AppState.selectedFilters.length > 0) {
                    const filterBtn = document.getElementById('filter-btn');
                    filterBtn.textContent = `–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (${AppState.selectedFilters.length})`;
                }
                
                Brick.showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!');
            },
        };



        /* ================================================================== */
        /* 4. SCREEN MODULES (–û–¢–î–ï–õ–¨–ù–´–ô –ú–û–î–£–õ–¨ –ù–ê –ö–ê–ñ–î–´–ô –≠–ö–†–ê–ù)           */
        /* ================================================================== */

        const CatalogModule = {
            init: () => {
                document.getElementById('view-toggle').addEventListener('click', CatalogModule.toggleView);
            },

            toggleView: () => {
                Brick.haptic('light');
                const grid = document.getElementById('catalog-grid');
                const icon = document.getElementById('view-toggle').querySelector('svg');
                
                if (grid.classList.contains('view-list')) {
                    Brick.removeClass(grid, 'view-list');
                    icon.innerHTML = '<path fill="var(--text-color)" d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"/>';
                } else {
                    Brick.addClass(grid, 'view-list');
                    icon.innerHTML = '<path fill="var(--text-color)" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>';
                }
            },

            filterByCategory: (category) => {
                Brick.haptic('light');
                Brick.showToast(`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ: ${category}`);
                ScreenNavigation.navigateTo(CONFIG.SCREENS.CATALOG);
            },
        };

        const ChatModule = {
            init: () => {
                DOM.getChatInput().addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') ChatModule.sendMessage();
                });
            },

            sendMessage: () => {
                const input = DOM.getChatInput();
                const message = input.value.trim();
                if (!message) return;

                Brick.haptic('light');
                const container = DOM.getChatMessages();

                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                container.innerHTML += `
                    <div class="chat-message user-message">
                        <div class="chat-bubble btn-outset">${message}</div>
                    </div>
                `;

                input.value = '';
                DOM.getContent().scrollTop = DOM.getContent().scrollHeight;

                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
                container.innerHTML += `
                    <div class="chat-message ai-message typing-message">
                        <div class="chat-bubble card-inset typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                `;
                DOM.getContent().scrollTop = DOM.getContent().scrollHeight;

                // AI –æ—Ç–≤–µ—Ç
                setTimeout(() => {
                    document.querySelector('.typing-message')?.remove();
                    
                    const response = ChatModule.generateResponse(message);
                    container.innerHTML += `
                        <div class="chat-message ai-message">
                            <div class="chat-bubble card-inset">${response}</div>
                        </div>
                    `;
                    
                    DOM.getContent().scrollTop = DOM.getContent().scrollHeight;
                }, CONFIG.ANIMATIONS.TYPING_DURATION);
            },

            generateResponse: (userMsg) => {
                const lower = userMsg.toLowerCase();
                
                if (lower.includes('–π–æ–≥—É—Ä—Ç') || lower.includes('–º–æ–ª–æ—á')) {
                    return `–°–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–∏–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º, –ª—É—á—à–∏–π –≤—ã–±–æ—Ä ‚Äî <strong>–ô–æ–≥—É—Ä—Ç Activia Natural</strong> (–†–µ–π—Ç–∏–Ω–≥ 9.2).`;
                }
                
                if (lower.includes('–ø—Ä–∏–≤–µ—Ç') || lower.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤')) {
                    return '–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É –≤–∞–º –≤—ã–±—Ä–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã. üòä';
                }
                
                return '–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å: –∫–∞–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?';
            },
        };

        const ShoppingListModule = {
            toggleItem: (element) => {
                Brick.haptic('light');
                Brick.toggleClass(element, 'done');
            },

            toggleHistory: (headerElement) => {
                Brick.haptic('light');
                const container = headerElement.nextElementSibling;
                const arrow = headerElement.querySelector('.history-arrow');
                if (container.style.display === 'none') {
                    container.style.display = 'block';
                    arrow.style.transform = 'rotate(180deg)';
                } else {
                    container.style.display = 'none';
                    arrow.style.transform = 'rotate(0deg)';
                }
            },
        };

        const ProfileModule = {
            init: () => {
                document.getElementById('theme-toggle-profile').addEventListener('click', ProfileModule.toggleTheme);
                ProfileModule.updateThemeDisplay();
            },

            toggleTheme: () => {
                const html = DOM.getRoot();
                const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
                html.setAttribute('data-theme', newTheme);
                TG_MOCK.WebApp.colorScheme = newTheme;
                ProfileModule.updateThemeDisplay();
                Brick.showToast(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ ${newTheme}`);
            },

            updateThemeDisplay: () => {
                const currentTheme = DOM.getRoot().getAttribute('data-theme');
                const label = document.getElementById('theme-label');
                const icon = document.getElementById('theme-icon');
                
                if (label) {
                    label.textContent = `–¢–µ–∫—É—â–∞—è: ${currentTheme === 'light' ? '–°–≤–µ—Ç–ª–∞—è' : '–¢–µ–º–Ω–∞—è'}`;
                }
                
                if (icon && currentTheme === 'light') {
                    icon.innerHTML = '<path fill="var(--text-color)" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
                } else if (icon) {
                    icon.innerHTML = '<path fill="var(--text-color)" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
                }
            },

            selectStore: (button) => {
                Brick.haptic('light');
                document.querySelectorAll('#store-screen .setting-button').forEach(btn => {
                    Brick.removeClass(btn, 'selected');
                    btn.querySelector('span').textContent = '>';
                });
                Brick.addClass(button, 'selected');
                button.querySelector('span').textContent = '‚úì –í—ã–±—Ä–∞–Ω–æ';
                Brick.showToast('–ú–∞–≥–∞–∑–∏–Ω –≤—ã–±—Ä–∞–Ω!');
            },

            toggleAllergy: (element) => {
                Brick.haptic('light');
                const checkbox = element.querySelector('.checkbox-switch');
                Brick.toggleClass(checkbox, 'done');
            },
        };

        const ProductDetailsScreen = {
            show: (card) => {
                Brick.haptic('light');
                const name = card.querySelector('.btn-outset').textContent;
                const rating = card.querySelector('.product-rating').textContent;

                ScreenNavigation.updateUIState(CONFIG.SCREENS.DETAILS, false, false);
                ScreenNavigation.switchScreen(CONFIG.SCREENS.DETAILS);
                
                const compositionText = `–ú–æ–ª–æ–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ, —Ñ—Ä—É–∫—Ç–æ–≤—ã–π –Ω–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–≤–∏—à–Ω—è, <span style="color: #c0392b; font-weight: bold;">—Å–∞—Ö–∞—Ä</span> (2-–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç), –≤–æ–¥–∞)`;
                const kbju = { k: 150, b: 5, j: 3, u: 25 };

                document.getElementById('details-screen').innerHTML = `
                    <div class="card-inset" style="padding: 25px; margin-bottom: 20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="margin:0;">–û—Ü–µ–Ω–∫–∞:</h3>
                            <div class="product-rating" style="position:static; background-color: ${rating > 7 ? '#27ae60' : rating > 4 ? '#f39c12' : '#c0392b'};">${rating}</div>
                        </div>
                        <div class="img-container">
                            <img src="${card.querySelector('img').src}" style="width:100%; height:auto; margin:0 0 10px; border-radius:15px;" />
                        </div>
                        <h4 style="margin-top:20px; font-weight:600; font-size:16px;">–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (–ö–ë–ñ–£)</h4>
                        <div class="card-inset" style="display:flex; justify-content:space-around; margin:10px 0; padding: 15px;">
                            <div style="text-align:center;"><span style="font-size:20px; font-weight:bold; color:var(--accent-color);">${kbju.k}</span><p style="font-size:12px; opacity:0.7; margin:0;">–ö–∫–∞–ª</p></div>
                            <div style="text-align:center;"><span style="font-size:20px; font-weight:bold; color:var(--accent-color);">${kbju.b}</span><p style="font-size:12px; opacity:0.7; margin:0;">–ë–µ–ª–∫–∏</p></div>
                            <div style="text-align:center;"><span style="font-size:20px; font-weight:bold; color:var(--accent-color);">${kbju.j}</span><p style="font-size:12px; opacity:0.7; margin:0;">–ñ–∏—Ä—ã</p></div>
                            <div style="text-align:center;"><span style="font-size:20px; font-weight:bold; color:var(--accent-color);">${kbju.u}</span><p style="font-size:12px; opacity:0.7; margin:0;">–£–≥–ª–µ–≤–æ–¥—ã</p></div>
                        </div>
                        <h4 style="margin-top:20px; font-weight:600; font-size:16px;">–ü–æ–ª–Ω—ã–π —Å–æ—Å—Ç–∞–≤</h4>
                        <p style="font-size:14px; line-height:1.6; padding:15px; border-radius:10px; background: var(--element-bg); box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">${compositionText}</p>
                        <button class="btn-outset chat-action-btn" style="width:100%; margin-top: 20px; justify-content: center;">üí¨ –°–ø—Ä–æ—Å–∏—Ç—å AI –æ —Å–æ—Å—Ç–∞–≤–µ</button>
                        <button class="btn-outset chat-action-btn" style="width:100%; background: #27ae60; color: white; justify-content: center; margin-top: 10px;">–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫</button>
                    </div>
                `;
            },
        };

        /* ================================================================== */
        /* 5. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø                                      */
        /* ================================================================== */

        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
            CatalogModule.init();
            ChatModule.init();
            ProfileModule.init();

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            DOM.getTabButtons().forEach(button => {
                button.addEventListener('click', (e) => {
                    const targetId = e.currentTarget.dataset.target;
                    ScreenNavigation.navigateTo(targetId);
                });
            });

            DOM.getBackButton().addEventListener('click', () => {
                ScreenNavigation.navigateTo(CONFIG.SCREENS.CATALOG);
            });

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
            document.getElementById('modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) ModalOrchestrator.hide();
            });



            // –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            ScreenNavigation.navigateTo(CONFIG.SCREENS.CATALOG);
        });
    </script>
</body>
</html>
